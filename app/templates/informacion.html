{% extends "base_home.html" %}
{% block body_class %}information-page{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/informacion.css') }}">
{% endblock %}
{% block content %}


<input type="checkbox" id="sidebar-toggle">

{% if 'user' in session %}
<!-- Sidebar -->
<div class="sidebar">
    <div class="sidebar-main">
        <!-- Logo -->
        <div class="sidebar-user">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" />
        </div>

        <!-- Menú para usuarios logueados -->
        <div class="sidebar-menu">
            <ul>
                <li>
                    <a href="{{ url_for('main.index') }}">
                        <span class="las la-home"></span>
                        Volver al inicio
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('repos.repositorios') }}">
                        <span class="las la-folder"></span>
                        Mis repositorios
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('usuarios.logout') }}">
                        <span class="las la-sign-out-alt"></span>
                        Cerrar sesión
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
{% else %}
<!-- Sidebar para usuarios no logueados -->
<div class="sidebar">
    <div class="sidebar-main">
        <div class="sidebar-user">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" />
        </div>

        <div class="sidebar-menu">
            <ul>
                <li>
                    <a href="{{ url_for('usuarios.registro') }}">
                        <span class="las la-user-plus"></span>
                        Crear usuario
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('usuarios.login') }}">
                        <span class="las la-sign-in-alt"></span>
                        Iniciar sesión
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
{% endif %}

<!-- Main Content -->
<div class="main-content">

    <header>
        <div class="menu-toggle">
            <label for="sidebar-toggle">
                <span class="las la-bars"></span>
            </label>
        </div>

        <div class="header-icons">
            <span class="las la-search"></span>

            <!-- Usuario con nombre -->
            <div class="user-info">
                <span class="las la-user"></span>
                <h3>{{ session.get('user') }}</h3>
            </div>
        </div>
    </header>

    <main>
        <div class="page-header">
            <div>
                <h1>Información del Repositorio</h1>
            </div>
        </div>

        <div class="cards">
            <div class="card-single repo-info-card">
                <div class="repo-layout">
                    <!-- Información textual -->
                    <div class="repo-details">
                        <h2>{{ repo.nombre }}</h2>
                        <p class="repo-desc">{{ repo.descripcion }}</p>

                        <div class="repo-meta">
                            <p><strong>Categoría:</strong> {{ repo.categoria }}</p>
                            <p><strong>Fecha de creación:</strong> {{ repo.fecha_creacion }}</p>

                            {% if repo.framework %}
                            <p><strong>Framework:</strong> {{ repo.framework }}</p>
                            {% endif %}

                            {% if repo.lenguaje %}
                            <p><strong>Lenguaje:</strong> {{ repo.lenguaje }}</p>
                            {% endif %}
                        </div>

                        <div class="repo-integrantes">
                            <h3>Integrantes</h3>
                            {% if repo.integrantes %}
                            <ul>
                                {% for integrante in repo.integrantes %}
                                <li>{{ integrante }}</li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p>No hay integrantes registrados.</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Multimedia -->
                    <div class="repo-media">
                        <h3>Archivos multimedia</h3>
                        {% if archivos %}
                        <div class="media-gallery">
                            {% for archivo in archivos %}
                            {% set enlace_directo = archivo.webViewLink.replace('dl=0', 'raw=1') %}
                            <div class="media-item">
                                {% if archivo.nombre.endswith(('.png', '.jpg', '.jpeg', '.webp', '.gif')) %}
                                <img src="{{ enlace_directo }}" alt="{{ archivo.nombre }}">
                                {% elif archivo.nombre.endswith(('.mp4', '.webm', '.ogg')) %}
                                <video controls>
                                    <source src="{{ enlace_directo }}">
                                </video>
                                {% endif %}

                                <!-- Nuevo botón de descarga -->
                                <a href="{{ archivo.webViewLink }}" target="_blank" class="button"
                                    data-tooltip="Descargar archivo">
                                    <div class="button-wrapper">
                                        <div class="text">Descargar</div>
                                        <span class="icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"
                                                width="2em" height="2em" preserveAspectRatio="xMidYMid meet"
                                                viewBox="0 0 24 24">
                                                <path fill="none" stroke="currentColor" stroke-linecap="round"
                                                    stroke-linejoin="round" stroke-width="2"
                                                    d="M12 15V3m0 12l-4-4m4 4l4-4M2 17l.621 2.485A2 2 0 0 0 4.561 21h14.878a2 2 0 0 0 1.94-1.515L22 17">
                                                </path>
                                            </svg>
                                        </span>
                                    </div>
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p>No hay archivos multimedia.</p>
                        {% endif %}
                    </div>

                </div>
            </div>
        </div>


    </main>
</div>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>

{% endblock %}