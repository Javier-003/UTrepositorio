{% extends "base_home.html" %}
{% block content %}
<h1>Mis Repositorios</h1>

<p>Bienvenido, {{ session.get('user') }}!</p>
<a href="{{ url_for('main.index') }}"><button>Volver al Inicio</button></a>
<a href="{{ url_for('usuarios.logout') }}"><button>Cerrar sesión</button></a>

<h2>Lista de Repositorios</h2>
{% if repos %}
<ul>
    {% for repo in repos %}
    <li>
        <strong>{{ repo.nombre }}</strong> - {{ repo.descripcion }}
        <a href="{{ url_for('repos.comandos', nombre=repo.nombre) }}">
            <button>Ver comandos</button>
        </a>
        <a href="{{ url_for('repos.explorar_archivos', nombre=repo.nombre) }}">
            <button>Explorar archivos</button>
        </a>
        <a href="{{ url_for('repos.informacion_repo',nombre=repo.nombre,repo_id=repo._id) }}">
            <button>Ver Información</button>
        </a>
        <form method="POST" action="{{ url_for('repos.eliminar', nombre=repo.nombre) }}" style="display:inline;">
            <button type="submit">Eliminar</button>
        </form>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No tienes repositorios aún.</p>
{% endif %}

<h2>Crear nuevo repositorio</h2>
{% with messages = get_flashed_messages() %}
{% if messages %}
<ul>
    {% for msg in messages %}
    <li style="color: {{ msg.color }}">{{ msg.texto }}</li>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}

<form method="POST" enctype="multipart/form-data" action="{{ url_for('repos.crear') }}">

    <div>
        <label>
            <p>Nombre del proyecto</p>
        </label>
        <label>
            <input type="text" name="nombre" placeholder="Nombre" required>
        </label>
    </div>
    <div>
        <label>Fecha de creación</label>
        <input type="date" required name="fecha_creacion" max="{{ current_date }}">
    </div>
    <script>
        // Si no usas Jinja para current_date, puedes hacerlo en JS:
        document.addEventListener('DOMContentLoaded', function () {
            var today = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="fecha_creacion"]').setAttribute('max', today);
        });
    </script>
    <div>
        <label>
            <p>Categoria</p>
        </label>
        <label>
            <input type="radio" name="categoria" value="Aplicación web" required> Aplicacion web
            <input type="radio" name="categoria" value="aplicación movil"> Aplicacion Movil
            <input type="radio" name="categoria" value="Emprendimiento"> Emprendimiento
            <input type="radio" name="categoria" value="Innovación"> Innovación
        </label>

    </div>
    <div id="web-movil-fields" style="display:none;">
        <div>
            <label>
                <input type="text" name="framework" placeholder="Framework utilizado" required>
            </label>
        </div>
        <div>
            <label>
                <input type="text" name="lenguaje" placeholder="Lenguaje principal" required>
            </label>
        </div>
        <div>
            <label>
                <input type="text" name="descripcion" placeholder="descripción general del proyecto" required>
            </label>
        </div>
        <div>
            <label>
                <p>Selecciona multimedia (solo imágenes JPG/PNG y videos MP4):</p>
                <input type="file" name="multimedia[]" accept="image/*,video/*" multiple id="multimedia-input">
            </label>
            <div id="preview" style="margin-top:10px;"></div>
        </div>
        <div>
            <label>
                <p>Integrantes (opcional):</p>
                <div id="integrantes-list" style="position: relative;">
                    <input type="text" name="Integrantes[]" placeholder="Nombre del integrante" class="integrante-input"
                        autocomplete="off">
                    <ul class="sugerencias"></ul>
                </div>
                <button type="button" id="add-integrante" style="margin-top:5px;">Agregar</button>
                <button type="button" id="remove-integrante" style="margin-top:5px;">Quitar</button>
            </label>
        </div>
        <div id="otros-fields">
            <label>
                <p>Escribe el objetivo del proyecto:</p>
                <input type="text" name="objetivo" placeholder="Objetivo del proyecto">
            </label>
        </div>
    </div>
    <button type="submit">Crear</button>
</form>

<script>
    document.querySelectorAll('input[name="categoria"]').forEach(function (radio) {
        radio.addEventListener('change', function () {
            var webMovil = document.getElementById('web-movil-fields');
            var otros = document.getElementById('otros-fields');
            if (this.value === 'Aplicación web' || this.value === 'aplicación movil') {
                webMovil.style.display = 'block';
                otros.style.display = 'none';
            } else {
                webMovil.style.display = 'none';
                otros.style.display = 'block';
            }
        });
    });
</script>

<script>
    document.getElementById('multimedia-input').addEventListener('change', function (event) {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';
        Array.from(event.target.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function (e) {
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '150px';
                    img.style.maxHeight = '150px';
                    img.style.margin = '5px';
                    preview.appendChild(img);
                } else if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = e.target.result;
                    video.controls = true;
                    video.style.maxWidth = '150px';
                    video.style.maxHeight = '150px';
                    video.style.margin = '5px';
                    preview.appendChild(video);
                }
            };
            reader.readAsDataURL(file);
        });
    });
</script>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}