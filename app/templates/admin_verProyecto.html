{% extends "base_home.html" %}
{% block body_class %}verproyectos-page{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/verproyecto.css') }}">
{% endblock %}
{% block content %}

<input type="checkbox" id="sidebar-toggle">

<!-- Sidebar -->
<div class="sidebar">

    <!-- Botón cerrar (mobile only) -->
    <label for="sidebar-toggle" class="close-sidebar">
        <span class="las la-times"></span>
    </label>

    <div class="sidebar-main">
        <div class="sidebar-user">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" />
        </div>

        <div class="sidebar-menu">
            {% if 'user' in session %}
            <ul>
                <li>
                    <a href="{{ url_for('admin.vistaAdmin') }}">
                        <span class="las la-home"></span>
                        Volver al inicio
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('usuarios.logout') }}">
                        <span class="las la-sign-out-alt"></span>
                        Cerrar sesión
                    </a>
                </li>
            </ul>
            {% else %}
            <ul>
                <li>
                    <a href="{{ url_for('usuarios.registro') }}">
                        <span class="las la-user-plus"></span>
                        Crear usuario
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('usuarios.login') }}">
                        <span class="las la-sign-in-alt"></span>
                        Iniciar sesión
                    </a>
                </li>
            </ul>
            {% endif %}
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">

    <header>
        <div class="menu-toggle">
            <label for="sidebar-toggle">
                <span class="las la-bars"></span>
            </label>
        </div>

        <div class="header-icons">
            <!-- Usuario con nombre -->
            <div class="user-info">
                <span class="las la-user"></span>
                <h3>{{ session['user']['username'] }}</h3>
            </div>
        </div>
    </header>

    <main>
        <div class="page-header">
            <div>
                <h1>Información del Repositorio</h1>
            </div>
        </div>

        <div class="cards">
            <div class="card-single repo-info-card">
                <div class="repo-layout">

                    <!-- Información textual -->
                    <div class="repo-details">
                        <h2>{{ repo.nombre }}</h2>
                        <p class="repo-desc">{{ repo.descripcion }}</p>

                        <div class="repo-meta">
                            <p><strong>Categoría:</strong> {{ repo.categoria }}</p>
                            <p><strong>Fecha de creación:</strong> {{ repo.fecha_creacion }}</p>

                            {% if repo.framework %}
                            <p><strong>Framework:</strong> {{ repo.framework }}</p>
                            {% endif %}

                            {% if repo.lenguaje %}
                            <p><strong>Lenguaje:</strong> {{ repo.lenguaje }}</p>
                            {% endif %}
                            {% if repo.estado %}
                            <p><strong>Estado:</strong> {{ repo.estado }}</p>
                            {% endif %}
                        </div>

                        <div class="repo-integrantes">
                            <h3>Integrantes</h3>
                            {% if repo.integrantes %}
                            <ul>
                                {% for integrante in repo.integrantes %}
                                <li>{{ integrante }}</li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p>No hay integrantes registrados.</p>
                            {% endif %}
                        </div>
                    </div>
                    <!-- Multimedia -->
                    <div class="carousel-container">
                        <div class="carousel-wrapper">
                            {% for archivo in archivos %}
                            {% set enlace_directo = archivo.webViewLink.replace('dl=0', 'raw=1') %}
                            <div class="carousel-item">
                                {% if archivo.nombre.endswith(('.png', '.jpg', '.jpeg', '.webp', '.gif')) %}
                                <img src="{{ enlace_directo }}" alt="{{ archivo.nombre }}">
                                {% elif archivo.nombre.endswith(('.mp4', '.webm', '.ogg')) %}
                                <video controls>
                                    <source src="{{ enlace_directo }}">
                                </video>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Controles -->
                        <button class="carousel-btn prev">❮</button>
                        <button class="carousel-btn next">❯</button>
                    </div>
                    <!-- Botón abrir modal -->
                    <a id="open-modal-btn" class="btn-new-repo">
                        Ver mas información
                    </a>
                    <!-- Botones de acción -->
                    {% if repo.estado == 'aceptado'%}
                    {% elif repo.estado == 'rechazado'%}
                    {% else %}
                    <div class="repo-buttons">
                        <a href="{{ url_for('admin.aceptar_proyecto', repo_id=repo._id) }}" class="btn accept">
                            <span class="las la-check"></span> Aceptar Proyecto
                        </a>
                        <button class="btn delete" onclick="openRejectModal('{{ repo._id }}')">
                            <span class="las la-times"></span> Rechazar Proyecto
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>
</div>
<div id="modal-crear-repo" class="modal-overlay" style="display:none;">
    <div class="modal-content repo-modal">

        <span class="modal-close" id="close-modal-btn">&times;</span>

        <h2 class="form-title">Información del Proyecto</h2>

        <div class="repo-info-section">

            <div class="repo-block">
                <h3>Datos Generales</h3>
                <div class="info-grid">
                    <div class="info-item"><strong>Nombre:</strong> {{ repo.nombre }}</div>
                    <div class="info-item"><strong>Fecha de creación:</strong> {{ repo.fecha_creacion }}</div>
                    <div class="info-item">
                        <strong>Estado:</strong>
                        <span class="badge 
                            {% if repo.estado=='aceptado' %} badge-green 
                            {% elif repo.estado=='rechazado' %} badge-red 
                            {% else %} badge-yellow {% endif %}">
                            {{ repo.estado }}
                        </span>
                    </div>
                    <div class="info-item"><strong>Categoría:</strong> {{ repo.categoria }}</div>
                </div>
            </div>

            <div class="repo-block">
                <h3>Tecnologías</h3>
                <div class="info-grid">
                    <div class="info-item"><strong>Framework(s):</strong> {{ repo.framework }}</div>
                    <div class="info-item"><strong>Lenguaje(s):</strong> {{ repo.lenguaje }}</div>
                    <div class="info-item"><strong>Plataforma:</strong> {{ repo.plataforma }}</div>
                    <div class="info-item"><strong>Versión:</strong> {{ repo.version_control }}</div>
                </div>
            </div>

            <div class="repo-block">
                <h3>Descripción</h3>
                <p class="info-description">{{ repo.descripcion }}</p>
            </div>

            <div class="repo-block">
                <h3>Integrantes</h3>
                {% if repo.integrantes %}
                <ul class="integrantes-list">
                    {% for integrante in repo.integrantes %}
                    <li class="integrante-item">
                        <i class="las la-user"></i> {{ integrante }}
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="no-integrantes">No hay integrantes registrados.</p>
                {% endif %}
            </div>

            <div class="repo-block">
                <h3>Información Adicional</h3>
                <div class="info-grid">
                    <div class="info-item"><strong>Objetivo:</strong> {{ repo.objetivos }}</div>
                    <div class="info-item"><strong>Retos:</strong> {{ repo.retos }}</div>
                    <div class="info-item"><strong>Prioridad:</strong> {{ repo.prioridad }}</div>
                    <div class="info-item"><strong>Comentarios:</strong> {{ repo.comentarios }}</div>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- Modal de Rechazo -->
<div id="rejectModal" class="modal" style="display:none;">
    <div class="modal-content">
        <h2>Motivo del rechazo</h2>

        <form id="rejectForm" method="POST">
            <textarea name="razon" placeholder="Describe el motivo del rechazo..." required></textarea>

            <div class="modal-buttons">
                <button type="button" class="btn" onclick="closeRejectModal()">Cancelar</button>
                <button type="submit" class="btn delete">Enviar Rechazo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const wrapper = document.querySelector(".carousel-wrapper");
        const items = document.querySelectorAll(".carousel-item");
        const btnPrev = document.querySelector(".carousel-btn.prev");
        const btnNext = document.querySelector(".carousel-btn.next");

        let index = 0;

        function updateCarousel() {
            wrapper.style.transform = `translateX(-${index * 100}%)`;
        }

        btnNext.addEventListener("click", () => {
            index = (index + 1) % items.length;
            updateCarousel();
        });

        btnPrev.addEventListener("click", () => {
            index = (index - 1 + items.length) % items.length;
            updateCarousel();
        });
    });
</script>

<script>
    document.getElementById("open-modal-btn").addEventListener("click", function (e) {
        e.preventDefault();
        document.getElementById("modal-crear-repo").style.display = "flex";
    });

    document.getElementById("close-modal-btn").addEventListener("click", function () {
        document.getElementById("modal-crear-repo").style.display = "none";
    });

    // Cerrar al hacer clic fuera del modal
    window.addEventListener("click", function (e) {
        const modal = document.getElementById("modal-crear-repo");
        if (e.target === modal) {
            modal.style.display = "none";
        }
    });
</script>

<script>
function openRejectModal(repoId) {
    document.getElementById('rejectModal').style.display = 'flex';
    document.getElementById('rejectForm').action = `/administrador/rechazar_proyecto/${repoId}`;
}

function closeRejectModal() {
    document.getElementById('rejectModal').style.display = 'none';
}
</script>


{% endblock %}